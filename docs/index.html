<!-- HTML header for doxygen 1.8.12-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PhpBotFramework: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="PhpBotFramework_Logo_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PhpBotFramework
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">A framework for Telegram Bots&#39; APIs.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-84714824-4', 'auto');
  ga('send', 'pageview');
</script>
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">PhpBotFramework Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Description"></a>
Description</h1>
<p>PhpBotFramework a lightweight framework for Telegram <a class="el" href="classDanySpin97_1_1PhpBotFramework_1_1Bot.html" title="Bot class to handle updates and commandes. ">Bot</a> API. Designed to be fast and easy to use, it provides all the features a user need. Take control of your bot using the command-handler system or the update type based function.</p>
<h2><a class="anchor" id="Example"></a>
Example</h2>
<p>A quick example, the bot will send "Hello" every time the user click "/start": </p><pre class="fragment">&lt;?php

// Include the framework
require './vendor/autoload.php';

// Create the bot
$bot = new DanySpin97\PhpBotFramework\Bot("token");

// Add a command that will be triggered every time the user click /start
$bot-&gt;addMessageCommand("start",
    function($bot, $message) {
        $bot-&gt;sendMessage("Hello");
    }
);

// Receive update from telegram using getUpdates
$bot-&gt;getUpdatesLocal();
</pre><h1><a class="anchor" id="Features"></a>
Features</h1>
<ul>
<li>Designed to be the fast and easy to use</li>
<li>Support for getUpdates and webhooks</li>
<li>Support for the most important API methods</li>
<li>Command-handle system</li>
<li>Update type based processing</li>
<li>Easy inline keyboard creation</li>
<li>Inline query results handler</li>
<li>Sql database support</li>
<li>Redis support</li>
<li>Support for multilanguage bot</li>
<li>Support for bot state</li>
<li>Highly documented</li>
</ul>
<h1><a class="anchor" id="Requirements"></a>
Requirements</h1>
<ul>
<li>Php 7.0 or greater</li>
<li>php-mbstring</li>
<li>Composer (to install the framework)</li>
<li>SSL certificate (<em>required by webhook</em>)</li>
<li>Web server (<em>required by webhook</em>)</li>
</ul>
<h1><a class="anchor" id="Installation"></a>
Installation</h1>
<p>In your project folder: </p><pre class="fragment">composer require danyspin97/php-bot-framework
composer install --no-dev
</pre><h2><a class="anchor" id="Web-server"></a>
Web-server</h2>
<p>To use webhook for the bot, a web server and a SSL certificate are required. Install one using your package manager (nginx or caddy reccomended). To get a SSL certificate you can user <a href="https://letsencrypt.org/">Let's Encrypt</a>.</p>
<h1><a class="anchor" id="Usage"></a>
Usage</h1>
<p>Add the scripting by adding command (addMessageCommand()) or by creating a class that inherits <a class="el" href="classDanySpin97_1_1PhpBotFramework_1_1Bot.html" title="Bot class to handle updates and commandes. ">Bot</a>. Each api call will have $chat_id set to the current user, use setChatID($chat_id) to change it.</p>
<h2><a class="anchor" id="getUpdates"></a>
getUpdates</h2>
<p>The bot ask for updates to telegram server. If you want to use getUpdates method to receive updates from telegram, add one of these function at the end of your bot:</p><ul>
<li><code>getUpdatesLocal()</code></li>
<li><code>getUpdatesDatabase()</code></li>
<li><code>getUpdatesRedis()</code></li>
</ul>
<p>The bot will process updates in a row, and will call <code>processUpdate()</code> for each. getUpdates handling is single-threaded so there will be only one object that will process updates, so the connection will be opened at the creation and used for the entire life of the bot.</p>
<h2><a class="anchor" id="Webhook"></a>
Webhook</h2>
<p>A web server will create an instance of the bot for every update received. If you want to use webhook call <code>processWebhookUpdate()</code> at the end of your bot. The bot will get data from php://input and process it using <code>processUpdate()</code>. Each instance of the bot will open its connection.</p>
<h2><a class="anchor" id="Commands"></a>
Commands</h2>
<p>Script how the bot will answer to messages containing commands (like <code>/start</code>). </p><pre class="fragment">$bot-&gt;addMessageCommand("/start", function($bot, $message) {
        $bot-&gt;sendMessage("I am your personal bot, try /help command");
});

$help_function = function($bot, $message) {
    $bot-&gt;sendMessage("This is the help message")
};

$bot-&gt;addMessageCommand("/help", $help_function);
</pre><h2><a class="anchor" id="Bot-Intherited"></a>
Inherit Bot Class</h2>
<p>Create a new class that inherits <a class="el" href="classDanySpin97_1_1PhpBotFramework_1_1Bot.html" title="Bot class to handle updates and commandes. ">Bot</a> to handle all updates.</p>
<p><code>EchoBot.php</code> </p><pre class="fragment">class EchoBot extends DanySpin97\PhpBotFramework\Bot {
    protected function processMessage(&amp;$message) {
        $this-&gt;sendMessage($this-&gt;getText());
    }
}
</pre><p><code>main.php</code> </p><pre class="fragment">$bot = new EchoBot("token");
$bot-&gt;processWebhookUpdate();
</pre><p>Override these method to make your bot handle each update type:</p><ul>
<li><code>processMessage(&amp;$message)</code></li>
<li><code>processCallbackQuery(&amp;$callback_query)</code></li>
<li><code>processInlineQuery(&amp;$inline_query)</code></li>
<li><code>processChosenInlineResult(&amp;$chosen_inline_result)</code></li>
<li><code>processEditedMessage(&amp;$edited_message)</code></li>
</ul>
<h2><a class="anchor" id="InlineKeyboard-Usage"></a>
InlineKeyboard Usage</h2>
<p>How to use the <a class="el" href="classDanySpin97_1_1PhpBotFramework_1_1InlineKeyboard.html" title="Inline Keyboard handler that create and handle inline keyboard buttons. ">InlineKeyboard</a> class: </p><pre class="fragment">// Create the bot
$bot = new DanySpin97\PhpBotFramework\Bot("token");

// Create the inline keyboard object that will handle buttons
$bot-&gt;inline_keyboard = new DanySpin97\PhpBotFramework\InlineKeyboard();

$command_function = function($bot, $message) {
        // Add a button to the inline keyboard
        $bot-&gt;inline_keyboard-&gt;addLevelButtons([
             // with written "Click me!"
             'text' =&gt; 'Click me!',
             // and that open the telegram site, if pressed
             'url' =&gt; 'telegram.me'
             ]);
        // Then send a message, with our keyboard in the parameter $reply_markup of sendMessage
        $bot-&gt;sendMessage("This is a test message", $bot-&gt;inline_keyboard-&gt;get());
        }

// Add the command
$bot-&gt;addMessageCommand("start", $command_function);
</pre><h2><a class="anchor" id="Sql-Database"></a>
Sql Database</h2>
<p>The sql database is used to save offset from getUpdates and to save user language. To connect a sql database to the bot, a pdo connection is required. Here is a simple pdo connection that is passed to the bot: </p><pre class="fragment">$bot-&gt;pdo = new PDO('mysql:host=localhost;dbname=test', $user, $pass);
</pre><h2><a class="anchor" id="Redis-database"></a>
Redis Database</h2>
<p>Redis is used to save offset from getUpdates, to store language (both as cache and persistent) and to save bot state. To connect redis with the bot, craete a redis object. </p><pre class="fragment">$bot-&gt;redis = new Redis();
</pre><h2><a class="anchor" id="Multilanguage-section"></a>
Multilanguage Bot</h2>
<p>This framework offers method to develop a multi language bot. Here's an example: </p><pre class="fragment">$bot-&gt;localization = [ 'en' =&gt;
                              [ 'Greetings_Msg' =&gt; 'Hello'],
                       'it' =&gt;
                              [ 'Greetings_Msg' =&gt; 'Ciao']];

$start_function = function($bot, $message) {
        $bot-&gt;sendMessage($this-&gt;localization[
                $bot-&gt;getLanguageDatabase()]['Greetings_Msg'])
};

$bot-&gt;addMessageCommand("start", $start_function);
</pre><p>The bot will get the language from the database, then the bot will send the message localizated for the user.</p>
<p><a class="el" href="group__Multilanguage.html">Multilanguage</a> [See here for more]</p>
<h1><a class="anchor" id="Bot-created"></a>
Bot using this framework</h1>
<ul>
<li><a href="https://telegram.me/myaddressbookbot">@MyAddressBookBot</a> (<a href="https://github.com/DanySpin97/MyAddressBookBot">Source</a>)</li>
<li><a href="https://telegram.me/giveaways_bot">@Giveaways_bot</a></li>
</ul>
<h1><a class="anchor" id="Authors"></a>
Authors</h1>
<p>This framework is developed and manteined by Danilo Spinella.</p>
<h1><a class="anchor" id="License"></a>
License</h1>
<p>PhpBotFramework is released under GNU Lesser General Public License. You may copy, distribute and modify the software provided that modifications are described and licensed for free under LGPL-3. Derivatives works (including modifications) can only be redistributed under LGPL-3, but applications that use the wrapper don't have to be. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
